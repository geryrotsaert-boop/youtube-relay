<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>YouTube Relay API - DJ Videos</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { width: 100%; height: 100%; overflow: hidden; background: #000; }
        #player { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        #error {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: #fff;
            font-family: Arial, sans-serif;
        }
    </style>
</head>
<body>
    <div id="player"></div>
    <div id="error">
        <h1>⚠️ Erreur</h1>
        <p>Impossible de charger le lecteur YouTube</p>
    </div>
    
    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
        let player = null;
        let isReady = false;
        
        const urlParams = new URLSearchParams(window.location.search);
        const initialVideoId = urlParams.get('v');
        
        function sendMessageToParent(type, data) {
            if (window.parent !== window) {
                window.parent.postMessage({
                    source: 'youtube-relay',
                    type: type,
                    data: data
                }, '*');
            }
        }
        
        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                height: '100%',
                width: '100%',
                videoId: initialVideoId || '',
                host: 'https://www.youtube-nocookie.com',
                playerVars: {
                    'autoplay': 1,
                    'controls': 1,
                    'rel': 0,
                    'fs': 1,
                    'modestbranding': 1
                },
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange,
                    'onError': onPlayerError
                }
            });
        }
        
        function onPlayerReady(event) {
            isReady = true;
            sendMessageToParent('onReady', {
                videoId: initialVideoId
            });
        }
        
        function onPlayerStateChange(event) {
            sendMessageToParent('onStateChange', {
                state: event.data,
                videoId: player.getVideoData().video_id,
                currentTime: player.getCurrentTime(),
                duration: player.getDuration()
            });
        }
        
        function onPlayerError(event) {
            sendMessageToParent('onError', {
                error: event.data,
                videoId: player.getVideoData().video_id
            });
        }
        
        window.addEventListener('message', function(event) {
            if (!player || !isReady) return;
            
            const message = event.data;
            if (!message || !message.command) return;
            
            try {
                switch(message.command) {
                    case 'loadVideoById':
                        if (message.videoId) {
                            player.loadVideoById(message.videoId);
                        }
                        break;
                    
                    case 'playVideo':
                        player.playVideo();
                        break;
                    
                    case 'pauseVideo':
                        player.pauseVideo();
                        break;
                    
                    case 'stopVideo':
                        player.stopVideo();
                        break;
                    
                    case 'seekTo':
                        if (typeof message.seconds !== 'undefined') {
                            player.seekTo(message.seconds, message.allowSeekAhead !== false);
                        }
                        break;
                    
                    case 'setVolume':
                        if (typeof message.volume !== 'undefined') {
                            player.setVolume(message.volume);
                        }
                        break;
                    
                    case 'mute':
                        player.mute();
                        break;
                    
                    case 'unMute':
                        player.unMute();
                        break;
                    
                    case 'getPlayerState':
                        sendMessageToParent('playerState', {
                            state: player.getPlayerState(),
                            currentTime: player.getCurrentTime(),
                            duration: player.getDuration(),
                            volume: player.getVolume(),
                            isMuted: player.isMuted()
                        });
                        break;
                    
                    case 'getCurrentTime':
                        sendMessageToParent('currentTime', {
                            currentTime: player.getCurrentTime()
                        });
                        break;
                    
                    case 'getDuration':
                        sendMessageToParent('duration', {
                            duration: player.getDuration()
                        });
                        break;
                }
            } catch(e) {
                sendMessageToParent('error', {
                    error: 'Command execution failed: ' + e.message
                });
            }
        });
        
        window.addEventListener('error', function(e) {
            document.getElementById('player').style.display = 'none';
            document.getElementById('error').style.display = 'block';
            sendMessageToParent('loadError', {
                message: e.message
            });
        });
    </script>
</body>
</html>
